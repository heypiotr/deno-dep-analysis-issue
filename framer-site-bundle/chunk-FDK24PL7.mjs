import{A as _,V as I,Z as W,a as B,c as h,d as L,e as x,f as w,i as p,j as D,k as R,l as k,m as F,n as d,p as S,s as $,t as T,v as j,w as m,z as g}from"./chunk-2TQEHBBO.mjs";import{b as P}from"./chunk-JXOLF6V7.mjs";function N(t){let e=Object.keys(t).join(""),n=/\w/.test(e);return n&&(e=e.replace(/\w/g,"")),`[${n?"\\w":""}${e.replace(/[^\w\s]/g,"\\$&")}]`}function Z(t){let e=Object.create(null),n=Object.create(null);for(let{label:i}of t){e[i[0]]=!0;for(let s=1;s<i.length;s++)n[i[s]]=!0}let o=N(e)+N(n)+"*$";return[new RegExp("^"+o),new RegExp(o)]}function Le(t){let e=t.map(i=>typeof i=="string"?{label:i}:i),[n,o]=e.every(i=>/^\w+$/.test(i.label))?[/\w*$/,/\w+$/]:Z(e);return i=>{let s=i.matchBefore(o);return s||i.explicit?{from:s?s.from:i.pos,options:e,validFor:n}:null}}function De(t,e){return n=>{for(let o=I(n.state).resolveInner(n.pos,-1);o;o=o.parent){if(t.indexOf(o.name)>-1)return null;if(o.type.isTop)break}return e(n)}}var ee=F.define();var te=g.baseTheme({".cm-tooltip.cm-tooltip-autocomplete":{"& > ul":{fontFamily:"monospace",whiteSpace:"nowrap",overflow:"hidden auto",maxWidth_fallback:"700px",maxWidth:"min(700px, 95vw)",minWidth:"250px",maxHeight:"10em",height:"100%",listStyle:"none",margin:0,padding:0,"& > li, & > completion-section":{padding:"1px 3px",lineHeight:1.2},"& > li":{overflowX:"hidden",textOverflow:"ellipsis",cursor:"pointer"},"& > completion-section":{display:"list-item",borderBottom:"1px solid silver",paddingLeft:"0.5em",opacity:.7}}},"&light .cm-tooltip-autocomplete ul li[aria-selected]":{background:"#17c",color:"white"},"&light .cm-tooltip-autocomplete-disabled ul li[aria-selected]":{background:"#777"},"&dark .cm-tooltip-autocomplete ul li[aria-selected]":{background:"#347",color:"white"},"&dark .cm-tooltip-autocomplete-disabled ul li[aria-selected]":{background:"#444"},".cm-completionListIncompleteTop:before, .cm-completionListIncompleteBottom:after":{content:'"\xB7\xB7\xB7"',opacity:.5,display:"block",textAlign:"center"},".cm-tooltip.cm-completionInfo":{position:"absolute",padding:"3px 9px",width:"max-content",maxWidth:"400px",boxSizing:"border-box"},".cm-completionInfo.cm-completionInfo-left":{right:"100%"},".cm-completionInfo.cm-completionInfo-right":{left:"100%"},".cm-completionInfo.cm-completionInfo-left-narrow":{right:"30px"},".cm-completionInfo.cm-completionInfo-right-narrow":{left:"30px"},"&light .cm-snippetField":{backgroundColor:"#00000022"},"&dark .cm-snippetField":{backgroundColor:"#ffffff22"},".cm-snippetFieldPosition":{verticalAlign:"text-top",width:0,height:"1.15em",display:"inline-block",margin:"0 -0.7px -.7em",borderLeft:"1.4px dotted #888"},".cm-completionMatchedText":{textDecoration:"underline"},".cm-completionDetail":{marginLeft:"0.5em",fontStyle:"italic"},".cm-completionIcon":{fontSize:"90%",width:".8em",display:"inline-block",textAlign:"center",paddingRight:".6em",opacity:"0.6",boxSizing:"content-box"},".cm-completionIcon-function, .cm-completionIcon-method":{"&:after":{content:"'\u0192'"}},".cm-completionIcon-class":{"&:after":{content:"'\u25CB'"}},".cm-completionIcon-interface":{"&:after":{content:"'\u25CC'"}},".cm-completionIcon-variable":{"&:after":{content:"'\u{1D465}'"}},".cm-completionIcon-constant":{"&:after":{content:"'\u{1D436}'"}},".cm-completionIcon-type":{"&:after":{content:"'\u{1D461}'"}},".cm-completionIcon-enum":{"&:after":{content:"'\u222A'"}},".cm-completionIcon-property":{"&:after":{content:"'\u25A1'"}},".cm-completionIcon-keyword":{"&:after":{content:"'\u{1F511}\uFE0E'"}},".cm-completionIcon-namespace":{"&:after":{content:"'\u25A2'"}},".cm-completionIcon-text":{"&:after":{content:"'abc'",fontSize:"50%",verticalAlign:"middle"}}}),ne=class{constructor(t,e,n,o){this.field=t,this.line=e,this.from=n,this.to=o}},K=class{map(t){let e=t.mapPos(this.from,-1,w.TrackDel),n=t.mapPos(this.to,1,w.TrackDel);return e==null||n==null?null:new K(this.field,e,n)}constructor(t,e,n){this.field=t,this.from=e,this.to=n}},H=class{instantiate(t,e){let n=[],o=[e],i=t.doc.lineAt(e),s=/^\s*/.exec(i.text)[0];for(let r of this.lines){if(n.length){let l=s,c=/^\t*/.exec(r)[0].length;for(let f=0;f<c;f++)l+=t.facet(W);o.push(e+l.length-c),r=l+r.slice(c)}n.push(r),e+=r.length+1}let a=this.fieldPositions.map(r=>new K(r.field,o[r.line]+r.from,o[r.line]+r.to));return{text:n,ranges:a}}static parse(t){let e=[],n=[],o=[],i;for(let s of t.split(/\r\n?|\n/)){for(;i=/[#$]\{(?:(\d+)(?::([^}]*))?|([^}]*))\}/.exec(s);){let a=i[1]?+i[1]:null,r=i[2]||i[3]||"",l=-1;for(let c=0;c<e.length;c++)(a!=null?e[c].seq==a:r&&e[c].name==r)&&(l=c);if(l<0){let c=0;for(;c<e.length&&(a==null||e[c].seq!=null&&e[c].seq<a);)c++;e.splice(c,0,{seq:a,name:r}),l=c;for(let f of o)f.field>=l&&f.field++}o.push(new ne(l,n.length,i.index,i.index+r.length)),s=s.slice(0,i.index)+r+s.slice(i.index+i[0].length)}for(let a;a=/\\([{}])/.exec(s);){s=s.slice(0,a.index)+a[1]+s.slice(a.index+a[0].length);for(let r of o)r.line==n.length&&r.from>a.index&&(r.from--,r.to--)}n.push(s)}return new H(n,o)}constructor(t,e){this.lines=t,this.fieldPositions=e}},ie=m.widget({widget:new class extends j{toDOM(){let t=document.createElement("span");return t.className="cm-snippetFieldPosition",t}ignoreEvent(){return!1}}}),oe=m.mark({class:"cm-snippetField"}),y=class{map(t){let e=[];for(let n of this.ranges){let o=n.map(t);if(!o)return null;e.push(o)}return new y(e,this.active)}selectionInsideField(t){return t.ranges.every(e=>this.ranges.some(n=>n.field==this.active&&n.from<=e.from&&n.to>=e.to))}constructor(t,e){this.ranges=t,this.active=e,this.deco=m.set(t.map(n=>(n.from==n.to?ie:oe).range(n.from,n.to)))}},C=d.define({map(t,e){return t&&t.map(e)}}),se=d.define(),v=R.define({create(){return null},update(t,e){for(let n of e.effects){if(n.is(C))return n.value;if(n.is(se)&&t)return new y(t.ranges,n.value)}return t&&e.docChanged&&(t=t.map(e.changes)),t&&e.selection&&!t.selectionInsideField(e.selection)&&(t=null),t},provide:t=>g.decorations.from(t,e=>e?e.deco:m.none)});function M(t,e){return p.create(t.filter(n=>n.field==e).map(n=>p.range(n.from,n.to)))}function le(t){let e=H.parse(t);return(n,o,i,s)=>{let{text:a,ranges:r}=e.instantiate(n.state,i),l={changes:{from:i,to:s,insert:B.of(a)},scrollIntoView:!0,annotations:o?ee.of(o):void 0};if(r.length&&(l.selection=M(r,0)),r.length>1){let c=new y(r,0),f=l.effects=[C.of(c)];n.state.field(v,!1)===void 0&&f.push(d.appendConfig.of([v,pe,ue,te]))}n.dispatch(n.state.update(l))}}function Q(t){return({state:e,dispatch:n})=>{let o=e.field(v,!1);if(!o||t<0&&o.active==0)return!1;let i=o.active+t,s=t>0&&!o.ranges.some(a=>a.field==i+t);return n(e.update({selection:M(o.ranges,i),effects:C.of(s?null:new y(o.ranges,i))})),!0}}var re=({state:t,dispatch:e})=>t.field(v,!1)?(e(t.update({effects:C.of(null)})),!0):!1,ae=Q(1),ce=Q(-1);var fe=[{key:"Tab",run:ae,shift:ce},{key:"Escape",run:re}],U=D.define({combine(t){return t.length?t[0]:fe}}),pe=k.highest(_.compute([U],t=>t.facet(U)));function ke(t,e){return Object.assign(Object.assign({},e),{apply:le(t)})}var ue=g.domEventHandlers({mousedown(t,e){let n=e.state.field(v,!1),o;if(!n||(o=e.posAtCoords({x:t.clientX,y:t.clientY}))==null)return!1;let i=n.ranges.find(s=>s.from<=o&&s.to>=o);return!i||i.field==n.active?!1:(e.dispatch({selection:M(n.ranges,i.field),effects:C.of(n.ranges.some(s=>s.field>i.field)?new y(n.ranges,i.field):null)}),!0)}});var b={brackets:["(","[","{","'",'"'],before:")]}:;>",stringPrefixes:[]},u=d.define({map(t,e){let n=e.mapPos(t,-1,w.TrackAfter);return n??void 0}}),V=new class extends ${};V.startSide=1;V.endSide=-1;var X=R.define({create(){return T.empty},update(t,e){if(e.selection){let n=e.state.doc.lineAt(e.selection.main.head).from,o=e.startState.doc.lineAt(e.startState.selection.main.head).from;n!=e.changes.mapPos(o,-1)&&(t=T.empty)}t=t.map(e.changes);for(let n of e.effects)n.is(u)&&(t=t.update({add:[V.range(n.value,n.value+1)]}));return t}});function Fe(){return[de,X]}var E="()[]{}<>";function Y(t){for(let e=0;e<E.length;e+=2)if(E.charCodeAt(e)==t)return E.charAt(e+1);return L(t<128?t:t+1)}function G(t,e){return t.languageDataAt("closeBrackets",e)[0]||b}var he=typeof P=="object"&&/Android\b/.test(P.userAgent),de=g.inputHandler.of((t,e,n,o)=>{if((he?t.composing:t.compositionStarted)||t.state.readOnly)return!1;let i=t.state.selection.main;if(o.length>2||o.length==2&&x(h(o,0))==1||e!=i.from||n!=i.to)return!1;let s=ge(t.state,o);return s?(t.dispatch(s),!0):!1}),me=({state:t,dispatch:e})=>{if(t.readOnly)return!1;let o=G(t,t.selection.main.head).brackets||b.brackets,i=null,s=t.changeByRange(a=>{if(a.empty){let r=ve(t.doc,a.head);for(let l of o)if(l==r&&A(t.doc,a.head)==Y(h(l,0)))return{changes:{from:a.head-l.length,to:a.head+l.length},range:p.cursor(a.head-l.length)}}return{range:i=a}});return i||e(t.update(s,{scrollIntoView:!0,userEvent:"delete.backward"})),!i},$e=[{key:"Backspace",run:me}];function ge(t,e){let n=G(t,t.selection.main.head),o=n.brackets||b.brackets;for(let i of o){let s=Y(h(i,0));if(e==i)return s==i?Ce(t,i,o.indexOf(i+i+i)>-1,n):be(t,i,s,n.before||b.before);if(e==s&&J(t,t.selection.main.from))return ye(t,i,s)}return null}function J(t,e){let n=!1;return t.field(X).between(0,t.doc.length,o=>{o==e&&(n=!0)}),n}function A(t,e){let n=t.sliceString(e,e+2);return n.slice(0,x(h(n,0)))}function ve(t,e){let n=t.sliceString(e-2,e);return x(h(n,0))==n.length?n:n.slice(1)}function be(t,e,n,o){let i=null,s=t.changeByRange(a=>{if(!a.empty)return{changes:[{insert:e,from:a.from},{insert:n,from:a.to}],effects:u.of(a.to+e.length),range:p.range(a.anchor+e.length,a.head+e.length)};let r=A(t.doc,a.head);return!r||/\s/.test(r)||o.indexOf(r)>-1?{changes:{insert:e+n,from:a.head},effects:u.of(a.head+e.length),range:p.cursor(a.head+e.length)}:{range:i=a}});return i?null:t.update(s,{scrollIntoView:!0,userEvent:"input.type"})}function ye(t,e,n){let o=null,i=t.changeByRange(s=>s.empty&&A(t.doc,s.head)==n?{changes:{from:s.head,to:s.head+n.length,insert:n},range:p.cursor(s.head+n.length)}:o={range:s});return o?null:t.update(i,{scrollIntoView:!0,userEvent:"input.type"})}function Ce(t,e,n,o){let i=o.stringPrefixes||b.stringPrefixes,s=null,a=t.changeByRange(r=>{if(!r.empty)return{changes:[{insert:e,from:r.from},{insert:e,from:r.to}],effects:u.of(r.to+e.length),range:p.range(r.anchor+e.length,r.head+e.length)};let l=r.head,c=A(t.doc,l),f;if(c==e){if(q(t,l))return{changes:{insert:e+e,from:l},effects:u.of(l+e.length),range:p.cursor(l+e.length)};if(J(t,l)){let O=n&&t.sliceDoc(l,l+e.length*3)==e+e+e?e+e+e:e;return{changes:{from:l,to:l+O.length,insert:O},range:p.cursor(l+O.length)}}}else{if(n&&t.sliceDoc(l-2*e.length,l)==e+e&&(f=z(t,l-2*e.length,i))>-1&&q(t,f))return{changes:{insert:e+e+e+e,from:l},effects:u.of(l+e.length),range:p.cursor(l+e.length)};if(t.charCategorizer(l)(c)!=S.Word&&z(t,l,i)>-1&&!xe(t,l,e,i))return{changes:{insert:e+e,from:l},effects:u.of(l+e.length),range:p.cursor(l+e.length)}}return{range:s=r}});return s?null:t.update(a,{scrollIntoView:!0,userEvent:"input.type"})}function q(t,e){let n=I(t).resolveInner(e+1);return n.parent&&n.from==e}function xe(t,e,n,o){let i=I(t).resolveInner(e,-1),s=o.reduce((a,r)=>Math.max(a,r.length),0);for(let a=0;a<5;a++){let r=t.sliceDoc(i.from,Math.min(i.to,i.from+n.length+s)),l=r.indexOf(n);if(!l||l>-1&&o.indexOf(r.slice(0,l))>-1){let f=i.firstChild;for(;f&&f.from==i.from&&f.to-f.from>n.length+l;){if(t.sliceDoc(f.to-n.length,f.to)==n)return!1;f=f.firstChild}return!0}let c=i.to==e&&i.parent;if(!c)break;i=c}return!1}function z(t,e,n){let o=t.charCategorizer(e);if(o(t.sliceDoc(e-1,e))!=S.Word)return e;for(let i of n){let s=e-i.length;if(t.sliceDoc(s,e)==i&&o(t.sliceDoc(s-1,s))!=S.Word)return s}return-1}export{Le as a,De as b,ke as c,Fe as d,$e as e};
//# sourceMappingURL=chunk-FDK24PL7.mjs.map
